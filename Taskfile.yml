version: "3"

vars:
  BIN: "{{.ROOT_DIR}}/bin"
  OUT_DIR: "{{.ROOT_DIR}}/build"
  APP_NAME: "application"
  HOOKS_DIR: "{{.ROOT_DIR}}/hooks"

env:
  CGO_ENABLED: "0"

tasks:
  default:
    cmds:
      - task: build
      - task: test

  install:
    desc: Install required tools
    cmds:
      - echo "ğŸ”§  Installing required tools..."
      - go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
      - go install github.com/cosmtrek/air@latest
      - echo "âœ… Tools installed."

  setup:hooks:
    desc: Set up Git hooks
    cmds:
      - echo "ğŸ”—  Setting up Git hooks..."
      - mkdir -p .git/hooks
      - ln -sf {{.HOOKS_DIR}}/pre-commit .git/hooks/pre-commit
      - ln -sf {{.HOOKS_DIR}}/pre-push .git/hooks/pre-push
      - chmod +x .git/hooks/pre-commit
      - chmod +x .git/hooks/pre-push
      - echo "âœ… Git hooks set up."

  setup:
    desc: Set up environment, install tools, and configure hooks
    cmds:
      - echo "ğŸ› ï¸  Setting up environment..."
      - task install
      - task setup:hooks
      - task update:dependencies
      - echo "âœ… Setup completed."

  setup:app:
    desc: Set up the application environment, including dependencies, hooks, and checks
    cmds:
      - task setup
      - task format
      - task lint
      - task test
      - task docs
      - echo "ğŸš€  Application setup completed."

  dev:
    desc: Run the application in development mode with hot reloading
    cmds:
      - echo "ğŸ”„  Starting development mode with hot reloading..."
      - air
      - swag init
      - echo "âœ… Development server is running."

  docs:
    desc: Generating the swagger api docs
    cmds:
      - echo "ğŸ”„  Generating the swagger api docs..."
      - swag init
      - echo "âœ… Complete."

  build:
    desc: Build the application
    deps:
      - clean
    cmds:
      - echo "ğŸ—ï¸  Building the application..."
      - go build -o {{.OUT_DIR}}/{{.APP_NAME}} main.go
      - echo "âœ… Build completed."

  prod:
    desc: Run the application in production mode
    cmds:
      - echo "ğŸš€  Running the application in production mode..."
      - "{{.OUT_DIR}}/{{.APP_NAME}}"
      - echo "âœ… Application running in production mode."

  clean:
    desc: Clean build artifacts
    cmds:
      - echo "ğŸ§¹  Cleaning build artifacts..."
      - rm -rf {{.OUT_DIR}}
      - echo "âœ… Clean completed."

  format:
    desc: Format code
    cmds:
      - echo "ğŸ“  Formatting code..."
      - gofmt -w .
      - echo "âœ… Code formatting completed."

  test:
    desc: Run tests
    cmds:
      - echo "ğŸ§ª  Running tests..."
      - go test ./...
      - echo "âœ… Tests completed."

  lint:
    desc: Run lint checks
    cmds:
      - echo "ğŸ”  Running lint checks..."
      - golangci-lint run
      - echo "âœ… Lint checks completed."

  lint:fix:
    desc: Run lint checks and fix issues
    cmds:
      - echo "ğŸ”§  Running lint checks and fixing issues..."
      - golangci-lint run --fix
      - echo "âœ… Lint checks and fixes completed."

  benchmark:
    desc: Run benchmarks
    cmds:
      - echo "ğŸ“Š  Running benchmarks..."
      - go test -bench=. ./...
      - echo "âœ… Benchmarks completed."

  update:dependencies:
    desc: Update Go module dependencies to their latest versions
    cmds:
      - echo "ğŸ”„  Updating dependencies..."
      - go get -u ./...
      - go mod tidy
      - echo "âœ… Dependencies updated."

  test:coverage:
    desc: Generate test coverage report
    cmds:
      - echo "ğŸ“ˆ  Generating test coverage report..."
      - go test -coverprofile=coverage.out ./...
      - go tool cover -html=coverage.out -o coverage.html
      - open coverage.html
      - echo "âœ… Test coverage report generated."
